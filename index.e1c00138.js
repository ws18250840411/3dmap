(()=>{"use strict";let e=[22.499175298089416,113.92055763860492],o=[{id:"marker1",position:[22.49873452335234,113.92084710744678]},{id:"marker2",position:[22.499309015991145,113.92109369200818]}],t=[{id:"mask-layer1",paths:[[22.498848426291726,113.9200162160721],[22.49857603262419,113.92080690762589],[22.49948978761296,113.9211741102115],[22.499762179556804,113.92037269737341]]},{id:"mask-layer2",paths:[[22.500368646631426,113.92210148717686],[22.50004681788184,113.92301193642277],[22.504157394997804,113.92460324329204],[22.504223222101064,113.92356612236836]]},{id:"mask-layer3",paths:[[22.50141728054279,113.92204109532372],[22.501317551951708,113.92226443304821],[22.5031298508702,113.92293816856409],[22.50141728054279,113.92204109532372]]}],n=[{id:"horse1",url:"/shumadasha/shunadasha2.gltf",position:[22.5009617334514,113.92265349975241,0],scale:[75,120,73],rotation:[0,249,0]},{id:"horse2",url:"/huayuancheng/huayuancheng2.gltf",position:[22.501486879246293,113.92307888668108,0],scale:[92,120,104],rotation:[0,251,0]},{id:"horse3",url:"/huayuanchengduimian/huayuangchengduimian2.gltf",position:[22.501587264924265,113.9229286685684,0],scale:[160,120,48],rotation:[0,250.18,0]},{id:"horse4",url:"/woerma/woerma2.gltf",position:[22.50176177956069,113.92329162772049,0],scale:[80,120,95],rotation:[0,250.2,0]}],a=new window.LBS.WebComponent.Geolocation({key:"MQDBZ-PUBCD-DFK4U-PIXEN-Q7BHT-YZBXK",referer:"h5-geolocation"}),i=window.TMap;window.addEventListener("load",function(){console.log("所有资源已加载完成");try{let r,l=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"container",t=window.TMap;if(!t)throw Error("TMap 未注入");let n=new t.LatLng(...e);return new t.Map(o,{center:n,zoom:17,pitch:45})}();!function(e){let o=window.TMap;if(!o)throw Error("TMap 未注入");let n=t.map(e=>({id:e.id,paths:e.paths.map(e=>new o.LatLng(...e))}));new o.MaskLayer({map:e,geometries:n}).on("click",e=>console.log("遮罩层点击事件：",e.geometry.id))}(l),function(e){let t=window.TMap;if(!t)throw Error("TMap 未注入");let n=o.map(e=>({id:e.id,styleId:"marker",position:new t.LatLng(...e.position)})),a=new t.MultiMarker({id:"marker-layer",map:e,styles:{marker:new t.MarkerStyle({width:20,height:28,enableRelativeScale:!0})},geometries:n});a.on("click",e=>{console.log("markerID:",e.geometry.id),console.log("当前marker位置：",e.geometry.position.toString())}),e.on("zoom_changed",()=>{let o=e.getZoom();a.setVisible(o>=16.5)})}(l),function(e){let o=window.TMap;if(!o)throw Error("TMap 未注入");let t=[];Promise.all(n.map(n=>{let a=new o.model.GLTFModel({url:n.url,map:e,id:n.id,position:new o.LatLng(...n.position),scale:n.scale,rotation:n.rotation});return t.push(a),new Promise(e=>{a.on("loaded",()=>{console.log("模型",n.id,"加载成功"),e()}),a.on("error",()=>{console.error("模型",n.id,"加载失败"),e()})})})).then(()=>{console.log("所有模型加载完成");let e=document.getElementById("mapLoading");e&&e.remove()})}(l),(r=document.getElementById("mapLocation"))&&r.addEventListener("click",()=>{a.getLocation?a.getLocation(e=>{let{lat:o,lng:t}=e;localStorage.setItem("mapLocation",JSON.stringify({lat:o,lng:t})),l.setCenter(new i.LatLng(o,t)),l.setZoom(17),console.log(">>> 定位成功回调数据",e)},o=>{if(localStorage.getItem("mapLocation")){let{lat:e,lng:o}=JSON.parse(localStorage.getItem("mapLocation")||"{}");l.setCenter(new i.LatLng(e,o)),l.setZoom(17)}else l.setCenter(new i.LatLng(...e)),l.setZoom(17);console.error("定位失败，错误信息：",o)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5}):(l.setCenter(new i.LatLng(...e)),l.setZoom(17))})}catch(e){console.error(e)}})})();