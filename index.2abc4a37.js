(()=>{"use strict";let e=[22.499175298089416,113.92055763860492],o=[{id:"marker1",position:[22.49873452335234,113.92084710744678]},{id:"marker2",position:[22.499309015991145,113.92109369200818]}],t=[{id:"mask-layer1",paths:[[22.498848426291726,113.9200162160721],[22.49857603262419,113.92080690762589],[22.49948978761296,113.9211741102115],[22.499762179556804,113.92037269737341]]},{id:"mask-layer2",paths:[[22.500368646631426,113.92210148717686],[22.50004681788184,113.92301193642277],[22.504157394997804,113.92460324329204],[22.504223222101064,113.92356612236836]]},{id:"mask-layer3",paths:[[22.50141728054279,113.92204109532372],[22.501317551951708,113.92226443304821],[22.5031298508702,113.92293816856409],[22.50141728054279,113.92204109532372]]}],a=[{id:"horse1",url:"/shumadasha/shunadasha2.gltf",position:[22.5009617334514,113.92265349975241,0],scale:[75,120,73],rotation:[0,249,0]},{id:"horse2",url:"/huayuancheng/huayuancheng2.gltf",position:[22.501486879246293,113.92307888668108,0],scale:[92,120,104],rotation:[0,251,0]},{id:"horse3",url:"/huayuanchengduimian/huayuangchengduimian2.gltf",position:[22.501587264924265,113.9229286685684,0],scale:[160,120,48],rotation:[0,250.18,0]},{id:"horse4",url:"/woerma/woerma2.gltf",position:[22.50176177956069,113.92329162772049,0],scale:[80,120,95],rotation:[0,250.2,0]}];window.addEventListener("load",function(){console.log("所有资源已加载完成");try{let i=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"container",t=window.TMap;if(!t)throw Error("TMap 未注入");let a=new t.LatLng(...e);return new t.Map(o,{center:a,zoom:17,pitch:45})}();!function(e){let o=window.TMap;if(!o)throw Error("TMap 未注入");let a=t.map(e=>({id:e.id,paths:e.paths.map(e=>new o.LatLng(...e))}));new o.MaskLayer({map:e,geometries:a}).on("click",e=>console.log("遮罩层点击事件：",e.geometry.id))}(i),function(e){let t=window.TMap;if(!t)throw Error("TMap 未注入");let a=o.map(e=>({id:e.id,styleId:"marker",position:new t.LatLng(...e.position)})),i=new t.MultiMarker({id:"marker-layer",map:e,styles:{marker:new t.MarkerStyle({width:20,height:28,enableRelativeScale:!0})},geometries:a});i.on("click",e=>{console.log("markerID:",e.geometry.id),console.log("当前marker位置：",e.geometry.position.toString())}),e.on("zoom_changed",()=>{let o=e.getZoom();i.setVisible(o>=16.5)})}(i),function(e){let o=window.TMap;if(!o)throw Error("TMap 未注入");let t=[];Promise.all(a.map(a=>{let i=new o.model.GLTFModel({url:a.url,map:e,id:a.id,position:new o.LatLng(...a.position),scale:a.scale,rotation:a.rotation});return t.push(i),new Promise(e=>{i.on("loaded",()=>{console.log("模型",a.id,"加载成功"),e()}),i.on("error",()=>{console.error("模型",a.id,"加载失败"),e()})})})).then(()=>{console.log("所有模型加载完成");let e=document.getElementById("mapLoading");e&&e.remove()})}(i);let n=window.wx;if(n&&n.miniProgram&&n.miniProgram.navigateBack){let e=document.getElementById("mapBack");e&&e.addEventListener("click",()=>{n.miniProgram.navigateBack()})}if(n&&n.miniProgram&&n.miniProgram.postMessage){let e=document.getElementById("mapLocation");e&&(e.addEventListener("click",()=>{n.miniProgram.postMessage({type:"requestLocation"})}),window.addEventListener("message",e=>{let o=e.data;"location"===o.type?console.log("小程序回传的位置：",o.data):"locationError"===o.type&&console.error("获取位置失败：",o.data)}))}}catch(e){console.error(e)}})})();